#!/bin/bash

. common

broken=''

for i in ${depPkgName}; do
	_pushd build/${i}/${svnbranch}
	if ${usechroot}; then
		sudo makechrootpkg -u -d -r ${chroot} -- --noconfirm || exit 1
	else
		makepkg -isL --noconfirm || exit 1
	fi
	_popd
done

for i in ${optPkgName}; do
	_pushd build/${i}/${svnbranch}
	if ${usechroot}; then
		if ${installall}; then
			sudo makechrootpkg -u -d -r ${chroot} -- --noconfirm || exit 1
		else
			sudo makechrootpkg -u -r ${chroot} -- --noconfirm || broken="${broken} ${i}"
		fi
	else
		makepkg -$(${installall} && echo 'i')sL --noconfirm || broken="${broken} ${i}"
	fi
	_popd
done

if [ "${broken}" != "" ]; then
	echo "Broken packages: ${broken}"
fi
