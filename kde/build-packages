#!/bin/bash

. common

broken=''
MAKEPKG_OPTS="--noconfirm -iL"

arch=$1
[ -z ${arch} ] && arch=$(uname -m)

for i in ${depPkgName}; do
	_pushd build/${i}/${svnbranch}
	${repo}-${arch}-build || exit 1
	sudo cp ${i}*${arch}${PKGEXT} /var/tmp/archbuild/${repo}-${arch}/copy
	sudo mkarchroot -r "pacman -U ${i}*${arch}${PKGEXT} --noconfirm" /var/tmp/archbuild/${repo}-${arch}/copy
	sudo rm /var/tmp/archbuild/${repo}-${arch}/copy/${i}*${arch}${PKGEXT}
	_popd
done

for i in ${optPkgName}; do
	_pushd build/${i}/${svnbranch}
	${repo}-${arch}-build || broken="${broken} ${i}"
	_popd
done

if ${l10n}; then
	_pushd build/kde-l10n/${svnbranch}
	${repo}-${arch}-build || broken="${broken} ${i}"
	_popd
fi

if [ "${broken}" != "" ]; then
	echo "Broken packages: ${broken}"
fi
