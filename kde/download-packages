#!/bin/bash

. common

host="ftpmaster.kde.org"

checkIntegrity() {
	if [ "$(sha1sum "${1}" | cut -d' ' -f1)" != "$(ssh ${host} sha1sum "${2}" | cut -d' ' -f1)" ]; then
		return 1
	else
		return 0
	fi
}

for i in `ssh ${host} ls ${branch}/${dirver}/src/xz/*-${kdever}.tar.xz`; do
	if [ ! -f "${SRCDEST}/$(basename ${i})" ]; then
		scp ${host}:~/${i} ${SRCDEST}/
	fi

	if checkIntegrity "${SRCDEST}/$(basename ${i})" "~/${i}"; then
		echo "$(basename ${i}) ok"
	else
		echo "$(basename ${i}) corrupted"
		exit 1
	fi
done

if ${l10n}; then
	for i in `ssh ${host} ls ${branch}/${dirver}/src/xz/kde-l10n/*-${kdever}.tar.xz`; do
		if [ ! -f "${SRCDEST}/$(basename ${i})" ]; then
			scp ${host}:~/${i} ${SRCDEST}/
		fi

		if checkIntegrity "${SRCDEST}/$(basename ${i})" "~/${i}"; then
			echo "$(basename ${i}) ok"
		else
			echo "$(basename ${i}) corrupted"
			exit 1
		fi
	done
fi
