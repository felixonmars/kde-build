#!/bin/bash

. /etc/makepkg.conf

kdever=${1}
cd build

for i in `cat ../kde-dep-packages ../kde-opt-packages`; do
	cd ${i}/trunk
	scp ktown.kde.org:~/stable/${kdever}/src/${i}-${kdever}.tar.bz2 ${SRCDEST}/
	sed -r "s|pkgver=.*|pkgver=${kdever}|g" -i PKGBUILD
	sed -r 's|pkgrel=.*|pkgrel=1|g' -i PKGBUILD
	{ rm PKGBUILD; awk '$0 ~ /^md5sums/ {i = 1; system("makepkg -g 2>/dev/null")}; !i {print}; $0 ~ /\)/ {i = 0}' > PKGBUILD; } < PKGBUILD
	cd ../..
done

for i in `cat ../kde-l10n-names`; do
	pkglang=$(echo "${i}" | tr [:upper:] [:lower:])
	cd kde-l10n-${pkglang}/trunk
	scp ktown.kde.org:~/stable/${kdever}/src/kde-l10n/kde-l10n-${i}-${kdever}.tar.bz2 ${SRCDEST}/
	sed -r "s|pkgver=.*|pkgver=${kdever}|g" -i PKGBUILD
	sed -r 's|pkgrel=.*|pkgrel=1|g' -i PKGBUILD
	{ rm PKGBUILD; awk '$0 ~ /^md5sums/ {i = 1; system("makepkg -g 2>/dev/null")}; !i {print}; $0 ~ /\)/ {i = 0}' > PKGBUILD; } < PKGBUILD
	cd ../..
done

cd ..